---
layout: post
title: Setting up Polymorphism in Ruby on Rails
date: '2017-01-25T18:31:00.000-08:00'
author: John Romani
tags:
- ruby
- design
- Object Oriented
- polymorphism
- ruby on rails
modified_time: '2017-01-25T18:31:03.451-08:00'
blogger_id: tag:blogger.com,1999:blog-5959763481811732424.post-722579977206093222
blogger_orig_url: http://johnromani90.blogspot.com/2017/01/setting-up-polymorphism-in-ruby-on-rails.html
---

Polymorphism can take a little longer to understand conceptually than other topics in OO. It is an abstraction which takes a little more effort for the developer to implement, but makes extending easier later on.<br />In this example I have three models that I want to add an attachment too: Patient, Prescriber, Order. Each attachment requires the same attributes and instead of adding a new attachment column on each model I am electing to create a new model called "AttachmentObject" and make it polymorphic. I am using the paperclip gem with S3 for attachment upload.<br /><pre class="brush:ruby;">class AddAttachmentPolyObject &lt; ActiveRecord::Migration<br />  def change<br />    create_table :attachment_objects do |t|<br />      t.string :title, null: false<br />      t.references :attachable, polymorphic: true, index: true, null: false<br />      t.attachment :attachment, null: false<br /><br />      t.timestamps<br />    end<br />  end<br />end<br /></pre><pre class="brush:ruby;"><br />class AttachmentObject &lt; ActiveRecord::Base<br /> belongs_to :attachable, polymorphic: true<br /> validates :title, :attachable_id, :attachable_type, presence: true<br />end<br /></pre><br />then for my relationships to my "attachable" models (Patient, Prescriber, Order).  <pre class="brush:ruby;"><br />class Patient &lt; ActiveRecord::Base<br /> has_many :attachment_objects, as: :attachable<br />end<br /><br /><br />class Prescriber &lt; ActiveRecord::Base<br /> has_many :attachment_objects, as: :attachable<br />end<br /><br /><br />class Order &lt; ActiveRecord::Base<br /> has_many :attachment_objects, as: :attachable<br />end<br /></pre><br />It is not necessary to name your "has_many" relationship with a name that uses "able" as a suffix, but you will see that it is a popular amongst rails devs and you should use it as a convention when possible. Now comes the fun parts. With my AttachmentObject I can now use rails helpers to find its related attachable parent. Active Record does this by looking up the 'attachable_type' (which points to either Patient, Prescriber, or Order table) and 'attachable_id' which points to a row on the table. for example:  <pre class="brush:ruby;"><br />#explicitly<br />order = Order.create( valid_attributes )<br />order_attachment = AttachmentObject.create(title: "phish", attachable_type: "order", attachable_id: order.id) <br /><br />#or implicitly<br />order_attachment = AttachmentObject.create(title: "phish", attachable: order) <br /></pre>I can then do  <pre class="brush:ruby;"><br />phish = AttachmentObject.find_by_title("phish") <br />phish.attachable #returns the related order_attachment<br /></pre>